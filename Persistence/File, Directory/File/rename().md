-----
### 파일 이름 변경
-----
1. 파일의 이름을 변경하는 것은 매우 유용
2. 명령 행에서 mv 명령으로 파일명을 변경할 수 있음
   - foo를 bar라는 새로운 이름으로 변경하는 명령어
```bash
prompt> mv foo bar
```

3. strace를 사용하면 mv가 rename(char *old, char *new)라는 두 개의 인자를 갖는 시스템 콜을 호출하는 것을 볼 수 있음 : 각 인자는 원래의 파일 이름(old)와 새로운 이름(new)을 나타냄
    - rename()은 (대체적으로) 시스템 크러시에 대해 원자적으로 구현되었음
    - 이름 변경 중 시스템 크래시가 발생했을 때, 파일 이름은 원래의 이름이나 새로운 이름, 둘 중 하나를 갖게 되며 그 사이 중간 상태는 발생하지 않음
    - 파일의 상태를 원자적으로 갱신해야 하는 응용 프로그램에 있어서 rename()은 매우 중요

4. 파일 편집기(예) emanc)로 파일 중간에 한 줄을 삽입한다고 가정
   - 파일 이름은 foo.txt이며, 새로운 파일이 원래의 내용과 추가된 줄을 모두 포함한다는 것이 보장되도록 하는 갱신 방법은 다음과 같음
```c
int fd = open(“foo.txt.tmp”, O_WRONLY|O_CREAT|O_TRUNC);
write(fd, buffer, size); // 파일의 새로운 버전 쓰기
fsync(fd);
close(fd);
rename(“foo.txt.tmp”, “foo.txt”);
```

   - 새로운 버전의 파일을 임의 이름(foo.txt.tmp)로 쓰고 fsync()로 디스크에 기록
   - 그 후 새로운 파일의 메타데이터와 내용이 디스크에 기록되었다는 것을 확인하면, 임시 파일 이름을 원래 파일 이름으로 변경
   - 이 마지막 단계에서 이전 버전 파일을 삭제하고, 동시에 새 파일로 교체하는 작업이 원자적으로 이루어짐
