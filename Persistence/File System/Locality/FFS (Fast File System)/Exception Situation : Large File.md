-----
### 대용량 파일 예외 상황
-----
1. 파일 배치 시 예외 상황으로 파일 크기가 매우 큰 경우
   - 별도의 규칙을 적용하지 않으면 하나의 파일이 블럭 그룹(그리고 다른 블럭들)을 모두 채울 수 있는데, 이는 바람직하지 않음 : 그 뒤의 관련있는 파일들은 다른 블럭 그룹에 저장되도록 만들어 파일 접근 지역성을 떨어트리기 때문임

2. FFS는 큰 파일들의 배치를 다음과 같이 처리
   - 첫 번째 블럭 그룹에 일정 수 블럭을 할당한 후(예) 블럭 12개 또는 아이노드의 직접 포인터 개수만큼), FFS는 파일의 큰 청크(예) 첫 번째 간접 블럭이 가리키고 있는 블럭들)를 다른 블럭 그룹(사용률이 낮은 것으로 선택)에 저장
   - 파을의 다음 청크는 마찬가지로 또 다른 블럭 그룹으로 저장

3. 큰 파일에 대한 에외가 없다면 하나의 큰 파일의 모든 블럭들을 디스크의 한 곳에 모아 저장하는 예 (FFS가 큰 파일에 대한 예외 처리 없이 저장한 경우)
<div align="center">
<img src="https://github.com/user-attachments/assets/b0d20fb4-504f-4add-be81-1d59782b3ada">
</div>

4. 큰 파일에 대한 예외 처리를 하면 다음과 같이 파일은 디스크 전반에 걸쳐 링크 단위로 저장
<div align="center">
<img src="https://github.com/user-attachments/assets/4996c35a-8821-4408-8ac5-c563cee0d4f5">
</div>

   - 파일 블럭들을 디스크에 흩어놓으면 상대적으로 흔한 순차 파일 접근과 달리 성능이 나빠질 수 있음
   - 따라서, 청크의 크기를 적절히 선택하는 것으로 이 문제를 약간은 경감 가능

5. 만약에 청크의 크기가 충분히 크다면, 디스크로부터 데이터를 전송하는 데 대부분 시간을 사용하고, 상대적으로 적은 시간을 블럭 청크들 간 탐색에 사용하게 될 것
   - 오버헤드 비용당 더 많은 작업을 처리하여 오버헤드를 줄이는 것 : 점진적 경감(Amortization) 기법
   - 예제) 디스크의 평균 위치 잡기 시간(즉, 탐색과 회전 시간)이 10 ms이고, 디스크가 데이터를 40 MB/s 속도로 전송한다고 가정
     + 전체 시간 중 탐색에 반을 사용하고 나머지를 데이터 전송에 쓰는 (따라서, 최대 디스크 성능의 50%를 얻는 것)이 목적이라하면, 위치 잡기를 위해 10 ms를 쓰고, 데이터를 전송하는데 10 ms를 사용해야 함
     + 전송하는데 10ms를 사용하는데 필요한 청크의 크기
<div align="center">
<img src="https://github.com/user-attachments/assets/e145a25b-fe20-402b-a2a3-1304847a7e0c">
</div>

   - 만약 40 MB/s의 속도로 데이터를 전송이 가능할 때 시간의 반은 전송에, 반은 탐색에 쓰려고 한다면 매 탐색마다 409.6 KB의 데이터를 전송해야 함
   - 비슷한 방법으로 최대 대역폭의 90%를 달성하기 위해 청크의 크기도 계산할 수 있음 : 3.69 MB
   - 또는 대역폭의 99%가 되도록 만들 때도 계산 가능 : 40.6 MB
   - 최대 대역폭에 가까운 성능을 원할수록 청크의 크기가 커져야 함
<div align="center">
<img src="https://github.com/user-attachments/assets/a5e06174-ea43-4a17-a33b-13817218de3a">
</div>

6. 그렇지만, FFS는 큰 파일을 그룹들 간 분산하는데 이와 같은 계산을 사용하지 않고, 대신 아이노드 자체 구조를 기반으로 하는 간단한 접근법 사용
   - 첫 번째 열 두개의 직접 블럭은 아이노드와 같은 그룹에 배치
   - 각 간접 블럭과 그것이 가리키는 모든 블럭들은 다른 그룹에 배치
   - 블럭 크기가 4KB이고 32비트 디스크 주소를 사용한다고 할 때, 이 전략은 직접 포인터가 가리키는 파일의 첫 48KB까지만 예외로 할당하고 파일의 매 1024개 블럭(4MB)마다 다른 그룹에 배치

7. 디스크 드라이브 전송 속도는 빠르게 증가하고 있음 : 제조사가 같은 면적에 더 많은 비트를 저장하는 기술을 개발하고 있음
   - 물론, 좋아지기는 하지만 탐색과 연관 있는 드라이브의 기계적 측면(디스크 암 속도와 회전 속도)로 인해 그 증가 정도는 아주 빠르지 않음
   - 시간이 갈수록 기계적 비용은 상대적으로 더 비싸지고 있음을 뜻하며, 그 비용을 점진적으로 경감하기 위해 더 많은 데이터를 전송해야함
