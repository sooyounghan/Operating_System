-----
### 파일 시스템 검사기
-----
1. 초기의 파일 시스템은 크래시 일관성 해결을 위해 간단한 방법을 사용
   - 기본적으로 파일 시스템이 일관성이 없더라도 그대로 두었다가 리부팅 시에 일관성 문제를 해결하는 방식 선택
   - FSCK라는 도구가 해당 접근 방식의 고전적인 예

2. FSCK는 일관성 불일치를 발견하고 수정하는 UNIX 도구
   - 이 방식은 그러나 문제를 전부 해결할 수 없음
   - 이 도구들의 목적은 파일 시스템의 메타데이터들 간의 일관성을 유지하는 것

3. FSCK의 동작은 여러 단계로 구성되며, 파일 시스템이 마운트 직전에 실행 (FSCK 실행 시에는 파일 시스템이 어떤 동작도 실행하지 않음을 가정)
   - 종료가 되면 디스크 상 파일 시스템이 일관성을 갖게 되며 사용자가 사용할 수 있게 됨

4. FSCK가 진행하는 기본적인 일
   - 슈퍼블럭 : FSCK는 먼저 슈퍼블럭의 내용에 오류가 없는지 검사
     + 대부분의 검사는 파일 시스템에 블럭 개수가 파일 시스템 크기보다 더 큰지와 같은 기초 검사들로 이루어져있음
     + 이러한 검사를 통해 (손상이) 의심되는 슈퍼블럭이 있는지 찾아내는 것
     + 발견하면 시스템은(또는 관리자는) 슈퍼블럭을 사본으로 대체할지 결정

   - 프리 블럭 : 그 다음으로 FSCK는 아이노드와 간접 블럭, 이중 간접 블럭 등 살펴보고 파일 시스템에 현재 블럭들이 할장되었는지에 대한 정보 생성
     + 얻은 정보를 토대로 정확한 할당 비트맵을 재구성
     + 기존의 비트맵과의 일치하지 않으면 아이노드 정보를 기반으로 불일치를 해결
     + 모든 아이노드에 대해서 같은 검사를 수행하여 아이노드의 비트맵의 유효성을 검사하고, 필요 시 아이노드의 비트맵을 재구성

   - 아이노드 상태 : 각 아이노드가 손상되었는지 다른 문제는 없는지 검사
     + 예를 들어, FSCK는 각 할당된 아이노드가 유효한 속성(예) 일반 파일, 디렉토리, 심볼릭 링크 등)을 갖고 있는지 확인
     + 만약, 아이노드의 항목 중 쉽게 해결이 불가능한 문제가 존재하면, FSCK는 해당 아이노드를 의심 대상으로 간주하고 초기화
     + 아이노드 비트맵도 그에 따라 갱신

   - 아이노드 링크 : FSCK는 각 할당된 아이노드 링크 개수를 확인
     + 링크의 개수는 특정 파일에 대한 참조를(즉, 링크) 포함하고 있는 디렉터리 수를 나타냄
     + 링크 개수를 확인하기 위해 FSCK는 루트 디렉토리를 시작으로 모든 디렉토리 트리를 탐색하여 파일 시스템의 모든 파일과 디렉터리에 대한 링크 개수를 직접 수집
     + 새롭게 계산된 개수와 아이노드에서 확인한 수와 다른 경우가 있다면, 일반적으로 아이노드 개수 필드를 고치는 방식으로 수정
     + 만약, 할당된 아이노드는 있지만 어떤 디렉토리도 참조하지 않는다면 그 파일은 lost + found 디렉터리로 이동

   - 중복 : FSCK는 중복된 포인터가 있는지도 검사
     + 즉, 같은 블럭을 가리키는 서로 다른 아이노드가 있는지 검사
     + 만약 한 아이노드가 누가봐도 불량이면 초기화
     + 대안으로 참조되고 있는 블럭 사본을 만들어서 원하는 대로 각 아이노드가 하나씩 자신의 블럭을 가리키도록 하는 방법 존재

   - 배드 블럭 : 모든 포인터 목록을 검사하면서 배드 블럭 포인터들도 함께 검사
     + 어떤 포인터가 배드라고 판단되면, 당연히 그 포인터가 유효하지 않는 공간을 참조하고 있다는 것을 의미
     + 예를 들면, 파티션 영역을 넘어서는 곳의 주소를 갖고 있는 경우, FSCK는 다른 해결 방법이 없으므로 아이노드나 간접 블럭에서 해당 포인터를 단순히 삭제(초기화)

   - 디렉터리 검사 : FSCK는 파일의 내용을 파악하는 것이 불가능하지만, 디렉터리 내용에 대해서는 파일 시스템에 생성한 구체적이고 서식화된 정보가 존재하므로 각 디렉터리 내용에 대해 추가적으로 모든 내용이 저장되어있는지 검사 수행
     + 디렉토리 첫 항목이 '.'과 '..'인지, 디렉토리 각 아이노드가 실제 할당되어 있는지 그리고 전체 계층에서 디렉토리가 두 번 이상 연결된 경우가 없는지 검사

5. FSCK와 유사한 접근법들은 보다 근본적 문제점 존재 : 너무 느리다는 점
   - 아주 큰 디스크 볼륨의 경우 디스크 전체에서 할당된 모든 블럭들을 찾고 디렉터리 트리 전부를 읽어내는 것은 몇 분에서 수 시간이 걸릴 수 있음
   - 디스크 용량이 커지고 RAID가 대중화되면서 FSCK는 실질적으로 사용이 불가능할 정도로 느림
   - 상위 계층에서의 세 개의 블럭만 디스크에 기록하는 경우의 예
     + 세 개의 블럭을 갱신하다 생긴 문제를 해결하기 위해 디스크 전체를 다 읽어보는 것은 엄청난 비용
     
