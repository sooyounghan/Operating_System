-----
### 크래시로부터 복구와 로그
-----
1. LFS에서 디스크에 쓰는 도중 시스템이 크래시 되는 경우
   - 일반적인 파일 시스템 동작에서 LFS는 쓰기 데이터를 세그먼트 버퍼에 먼저 기록하고 해당 세그먼트 버퍼를 (세그먼트가 가득 차면, 또는 일정 시간이 흐르면) 디스크에 기록
   - LFS는 이러한 쓰기들을 로그(Log)로 구성
   - 즉, 체크포인트 영역에 첫번째와 마지막 세그먼트를 가리키는 포인터를 두며, 각 세그먼트는 다음 섹므ㅓㄴ트를 가리키는 포인터를 둠
   - 즉, 전체 세그먼트들이 일종의 링크드 리스트로 연결되는 셈
   - 크래시는 언제든지 발생할 수 있으므로(세그먼트를 쓸 때 또는 체크포인트 영여을 갱신할 때) 체크포인트의 영역의 해당 정보는 주기적으로 갱신

2. 체크포인트 영역이 갱신되는 도중 크래시가 발생하는 경우
   - 체크포인트 영역은 원자적으로 갱신되어야 함
   - 체크포인트 영역이 원자적으로 갱신되는 것을 보장하기 위해 LFS는 두 개의 체크포인트 영역을 둠
   - 두 영역이 갱신되는 과정
     + LFS는 먼저 체크포인트 헤더(현재 시간 값 포함)를 기록한 후 체크포인트 영역에 내용을 쓰고, 최종적으로 체크포인트 영역의 마지막 블럭을 갱신
     + 마지막 블럭에도 현재 시간값이 포함되어 있음
     + 성공적으로 체크포인트 영역이 갱신될 경우에는 헤더 블럭의 시간값이 마지막 블럭의 시간값보다 작게 됨
     + 체크포인트 영역 갱신 중 크래시가 발생할 경우, 복구 시에 LFS는 헤더와 마지막 영역에 저장된 시간값을 비교
       * 만약, 헤더에 저장된 시간값이 더 크다면, 해당 체크포인트 영역을 갱신하는 도중 크래시 발생
       * LFS는 유효한 시간 값 쌍을 갖는 가장 최근 체크포인트 영역을 선택하여, 이 영역을 일관성있게 갱신할 수 있음

3. LFS는 30초마다 체크포인트 영역을 갱신
   - 따라서, 디스크에 저장된 체크포인트 영역의 내용, 즉, 파일 시스템 스냅샷은 최신 것이 아닐 수 있음
   - 크래시 시점을 기준으로 최대 30초 이전 상태를 반영할 수 있으며, 재부팅 시 복구 과정에서 LFS는 체크 포인트 영역을 읽어서 imap 조각들이 가리키는 곳을 확인하여 파일들과 디렉토리들을 복원
   - 이렇게 하면 마지막 수초 간 갱신 내용들이 손실되는 것을 피할 수 없음

4. 이 문제를 개선하기 위해 LFS는 데이터베이스에서 사용되는 롤 포워드(Roll Forward) 기법을 적용
   - 기본 개념은 최신 체크포인트 영역에서 시작
   - 복구 모듈은 체크포인트 영역을 읽어들여 세그먼트 리스트의 마지막 세그먼트 위치를 파악
   - 각 세그먼트는 다음 세그먼트를 가리키는 포인터들을 가지고 있으며, 체크포인트가 가리키는 마지막 세그먼트를 읽어서 이 세그먼트가 가리키는 다음 세그먼트들의 존재 여부를 검사하고, 필요하면 체크포인트의 마지막 세그먼트를 가리키는 포인터를 갱신
   - 이런식으로 계속 다음 세그먼트를 찾아나가며, 세그먼트 리스를 순회하여, 마지막 체크포인트 이후 데이터와 메타데이터를 복구
