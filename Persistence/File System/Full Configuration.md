-----
### 전체 구성
-----
1. VSFS 파일 시스템 자료 구조에 대해 디스크 상 전체적인 구성
2. 가장 먼저 해야할 것 : 디스크들을 블럭(Block)들로 나누는 것
   - 간단한 파일 시스템들은 단일 블럭 크기만 사용하므로 여기서도 동일하게 적용
   - 일반적으로 사용되는 크기인 4KB를 사용

3. 만들려는 파일 시스템의 디스크 파티션 구조는 단순 : 4KB 블럭들로 나열
   - N개의 4KB 블럭의 크기를 갖는 파티션에서 블럭은 0부터 N - 1까지의 주소를 가지고 있으며, 블럭이 64개 있는 작은 디스크를 가정
<div align="center">
<img src="https://github.com/user-attachments/assets/f5ab5643-30b7-40d7-bc67-c022f0e62de2">
</div>

  - 파일 시스템 대부분 공간은 사용자 데이터로 이루어져야 하므로, 사용자 데이터가 있는 디스크 공간을 데이터 영역(Data Region)이라 가정
  - 간단하게 64개 디스크 블럭 중 마지막 56개의 블럭처럼 디스크의 일정 부분을 데이터 영역으로 확보
<div align="center">
<img src="https://github.com/user-attachments/assets/621d7f99-4857-4063-822c-b5b840cf75a6">
</div>

4. 파일 시스템은 각 파일에 대한 정보를 관리하는데, 이를 메타데이터(Metadata)
   - 파일을 구성하는 데이터 블럭(데이터 영역 내)들과 그 파일의 크기, 소유자, 접근 권한, 접근과 변경 시간 등과 같은 정보들이 이에 해당
   - 파일 시스템은 이 정보를 보통 아이노드(I-node)라고 부르는 자료 구조에 저장
   - 아이노드들의 저장을 위해 디스크 공간이 필요 : 이 영역을 아이노드 테이블(I-node Table)이라 함
     + 아이노드 테이블에는 아이노드들이 배열 형태로 저장

   - 디스크 상 자료 구조 배치 : 전체 64개 블럭 중 5개의 블럭이 아이노드를 저장하기 위해 할당
<div align="center">
<img src="https://github.com/user-attachments/assets/0afbc758-eca5-42b5-a78f-6e3f8cca8729">
</div>

   - 아이노드는 일반적으로 128 ~ 256 Byte 정도로 크지 않으며, 아이노드 당 256 Byte라고 가정하면 4 KB 블럭에는 16개의 아이노드들이 저장될 수 있으며, 파일 시스템에는 총 80개의 아이노드 저장 가능
   - 64개의 블럭으로 구성된 작은 파일 시스템 파티션에 최대 80개 파일을 만들 수 있음을 의미
   - 같은 파일 시스템이라도 더 큰 디스크 파티션에 생성한다면 아이노드 테이블을 더 크게 만들 수 있으므로 생성가능한 최대 파일 갯수를 증가시킬 수 있음

5. 예제 파일 시스템에는 데이터 블럭(D)와 아이노드 블럭(I)이 존재
   - 꼭 필요한 정보는 아이노드나 데이터 블럭의 사용 여부에 관한 것
   - 즉, 각 블럭이 현재 사용 중인지 아닌지를 표현할 할당 구조(Allocation Structure)가 필요 : 이 정보는 어느 파일 시스템에서나 꼭 필요
   - 블럭이 사용 중인지 아닌지를 표현하는데 다양한 방법 존재
     + 예를 들면, 프리 리스트(Free List)를 사용해 사용 중이 아닌 블럭들을 링크드 리스트 형태로 관리할 수 있음 : 아이노드는 첫 번째 프리 블럭의 위치만 기억하면 됨
     + 단순한 비트맵(Bitmap)도 사용 가능 : 데이터 영역에 있는 블럭들의 사용 여부를 표현하기 위해 데이터 비트맵(Data Bitmap)을, 아이노드들이 사용 중인지 나타내기 위해 아이노드 비트맵(I-node Bitmap)을 사용
     + 비트맵은 비트들의 베열로서, 각 비트는 해당 블럭이나 객체(각 아이노드)가 사용 중인지(1) 아닌지(0)를 나타냄
<div align="center">
<img src="https://github.com/user-attachments/assets/cd04cae8-8838-4124-ae0c-a73377e0832c">
</div>

  - 초소형 파일 시스템의 경우 하나의 4KB 블럭(4096 Byte, 32 KBit) 전체를 비트맵으로 사용하는 것은 공간의 낭비이므로, 4 KByte 크기의 비트맵이면 32 K개의 객체에 대한 할당 정보를 관리할 수 있음
  - 예제 파일 시스템에는 아이노드가 80개, 데이터 블럭이 56개 존재하지만, 각 비트맵은 4KB 전부 사용한다고 가정

6. 남은 한 블럭 : 슈퍼 블럭(Superblock)
   - S로 표기하였으며, 이 파일 시스템 전체에 대한 정보를 가지고 있음
   - 즉, 예를 들어 파일 시스템에 몇 개의 아이노드가 있고, 몇 개의 데이터 블럭이 있는지(여기서는 80개 / 56개), 아이노드 테이블은 어디에서 시작하는지 (블럭 3번) 같은 정보를 담고 있음
   - 파일 시스템을 식별할 수 있는 매직 넘버도 가지고 있음 (이 경우, VSFS)
   - 파일 시스템이 깨진다는 것은 수퍼블럭이 젖아된 디스크 블럭이 훼손됨을 의미
   - 일반적으로 ,대부분 파일 시스템은 수퍼 블럭을 몇 개 복사해둠

7. 파일 시스템을 마운트할 때, 운영체제는 우선 슈퍼블럭을 읽어들여서 파일 시스템의 여러 요소들을 초기화
   - 그 후 각 파티션을 파일 시스템 트리에 붙이는 작업을 진행
   - 이렇게 함으로써, 디스크 볼륨에 있는 파일들을 접근할 때, 해당 파일을 읽거나 쓰는 데 필요한 자료 구조 파악
