-----
### 손상 검출 : 체크섬
-----
1. 현대의 저장 시스템이 데이터 무결성을 유지하기 위해 사용되는 주된 기술은 체크섬(Checksum)
   - 간단하게 말해서 데이터 청크(4KB 블럭이라 가정)를 입력하여 함수 값을 계산하는데, 이 결과는 데이터 내용에 대한 작은 요약 정보 (4 또는 8 바이트)
   - 체크섬의 목적은 데이터 손상이나 변경 여부를 시스템이 판단할 수 있도록 하는 것
   - 체크섬을 데이터와 함께 저장하여 저장된 데이터로부터 계산한 현재의 체크섬이 저장 장치에 기록되어 있는 체크섬 값과 같은지 확인

2. 널리 사용되는 체크섬 함수
   - 체크섬을 계산하기 위한 많은 함수들이 존재하며, 각 강도(즉, 데이터 무결성을 보호하는 정도)와 연산 속도(즉, 함수의 계산 처리 속도)가 상이
   - 일반적으로 보호의 강도가 강할수록 비용이 더 비싸짐

3. 간단한 체크섬 함수 : XOR 함수
   - XOR 기반 체크섬은 체크섬을 구하고자하는 각 데이터 블럭의 청크를 XOR 연산하여 최종적으로 전체 블럭을 대표하는 XOR 값 생성
   - 16바이트 크기의 블럭에 대해 4바이트 체크섬을 계산 예제 (이 블럭은 실제 디스크의 섹터나 블럭보다는 훨씬 작음)
   - 16진수로 표현된 16바이트 데이터
```
365e c4cd ba14 8a92 ecef 2c3a 40be f666
```
   - 바이너리로 재표현
```
0011 0110 0101 1110     1100 0100 1100 1101
1011 1010 0001 0100     1000 1010 1001 0010
1110 1100 1110 1111     0010 1100 0011 1010
0100 0000 1011 1110     1111 0110 0110 0110
```

   - 각 줄에 4바이트씩 데이터를 묶어 나열하므로 체크섬 결과를 확인하는 것이 쉬움
   - 각 열끼리 XOR 연산으로 얻은 체크섬의 값
```
0010 0000 0001 1011     1001 0100 0000 0011
```
   - 16진수로 표현하면 0x201b9403
   - XOR 방식은 합리적이기하지만 제한이 있음 : 체크섬을 계산하는 각 열에서 두 개의 값이 변하면 체크섬은 손상을 검출할 수 없음

4. 다른 기본 체크섬 함수 : 덧셈
   - 장점 : 빠름
   - 체크섬을 계산하려면 각 데이터의 청크에 2의 보수 덧셈을 하고, 만약 오버플로우가 발생하면 무시
   - 이 기법은 데이터의 많은 부분이 변경되었어도 변경된 경우 이를 발견할 수 있지만, 데이터가 쉬프트된 경우에는 발견 못할 수 있음

5. Fletcher Checksum
   - 두 개의 체크 바이트, s1과 s2의 계산이 필요한 비교적 간단한 방법
   - 블럭 D가 $d_{1}, ..., d_{n}$ 바이트로 이루어졌다고 가정하면, s1 = s1 + d mod 255 (모든 $d_{i}에 대해 연산), s2 = s2 + s1 mod 255 (이 때도, 모든 $d_{i}$에 대해서 연산)
   - 플렛처 체크섬은 CRC에 견줄만큼 강력하며, 모든 한 비트 / 두 비트 에러 / 그리고 많은 경우 동시다발적 에러 검출 가능

6. 흔히 사용되는 체크섬 : Cyclic Redundancy Check (CRC)
   - 데이터 블럭 D에 대해 체크섬을 계산한다고 가정
   - 이 때 할일은 주어진 D를 큰 이진수(사실 비트의 나열임)로 여기고 사전에 합의한 값(k)으로 나누는 것
   - 계산의 나머지 값은 CRC 값이 됨
   - 이진 나머지 연산(Modulo Operation)은 상당히 효율적으로 처리할 수 있으므로 CRC은 네트워크 분야에서도 인기가 있음

7. 어떤 방식이 사용되든 완벽한 체크섬은 없음
   - 두 개의 전혀 다른 내용을 갖고 있는 블럭이 동일한 체크섬을 가질 수 있는데, 이를 충돌(Collision)이라고 함
   - 결국, 체크섬을 계산한다는 것은 어떤 큰 것(예) 4KB)을 사용하여 작은 크기(예) 4 또는 8 Bytes)의 요약 정보를 만들어내는 것
   - 좋은 체크섬 함수를 선택한다는 것은 충돌 확률을 최소화하면서 계산은 간단하게 만드는 것
