-----
### 페이지 폴트
-----
1. TLB 미스 처리 방법에 따라 두 종류 시스템이 존재 : 하드웨어 기반 TLB(하드웨어가 페이지 테이블을 검색하여 원하는 변환 정보를 찾는 것)과 소프트웨어 기반 TLB(운영체제가 처리하는 것)
2. 단, 페이지 폴트는 발생하면 운영체제가 처리
   - 운영체제의 페이지 폴트 핸들러가 그 처리 메커니즘을 규정
   - 대부분의 시스템들에서 페이지 폴트는 소프트웨어적으로 처리
   - 하드웨어 기반의 TLB도 페이지 폴트 처리는 운영체제가 담당

3. 만약 요청된 페이지가 메모리에 없고, 디스크로 스왑되었다면, 운영체제는 해당 페이지를 메모리로 스왑해옴
   - 즉, 해당 페이지싀 스왑 공간 상의 위치를 페이지 테이블에 저장
   - 운영체제는 PFN과 같은 PTE 비트들을 페이지의 디스크 주소를 나타내는 데 사용 가능
   - 페이지 폴트 발생 시, 운영체제는 페이지 테이블 항목에서 해당 페이지의 디스크 상 위치를 파악해 메모리에 탑재
  
4. 디스크 I/O가 완료가 되면 운영체제는 해당 페이지 테이블 항목(PTE)의 PFN 값을 탑재된 페이지의 메모리 위치로 갱신
   - 이 작업이 완료되면 페이지 폴트를 발생시킨 명령어가 재실행
   - 재실행으로 인해 TLB 미스가 발생할 수 있는데, TLB 미스 처리 과정에서 TLB 값이 갱신 (이를 피하기 위한 대안으로 페이지 폴트 처리 시 함께 TLB를 갱신하도록 할 수 있음)
   - 마지막 재실행 시에 TLB에서 주소 변환 정보를 찾게 되고, 이를 이용하여 물리 주소에서 원하는 데이터나 명령어를 가져옴

5. I/O 전송 중에는 해당 프로세스가 차단된(Blocked) 상태가 된다는 것을 유의해야 함
   - 페이지 폴트 처리 시 운영체제는 다른 프로세스들을 실행할 수 있음
   - I/O 실행은 매우 시간이 많이 소요되므로 한 프로세스의 I/O작업 (페이지 폴트)과 다른 프로세스의 실행을 중첩(Overlap) 시키는 것은 멀티 프로그램된 시스템에서 하드웨어를 최대한 효율적으로 사용하는 방법

-----
### 참고 : 페이지 폴트를 하드웨어로 처리하지 않는 이유
-----
1. 페이지 폴트로 인한 디스크 접근이 느리기 때문임 : 페이지 폴트 처리에 시간이 소요된다 하더라도, 디스크 작업 자체가 너무 느리므로 소프트웨어를 실행하는 추가 부담은 절대적으로 작음
2. 페이지 폴트 처리를 위해서는 하드웨어가 스왑 공간의 구조, 디스크에 I/O를 요청하는 방법, 그 외 하드웨어가 파악하지 못하고 있는 세부적인 것들도 모두 알고 있어야 함

-----
### 메모리에 빈 공간이 존재하지 않을 때
-----
1. 스왑 공간으로부터 페이지를 가져오기 위한(Page-In) 여유 메모리가 충분하다고 가정했음
2. 메모리에 여유 공간이 없다면, 탑재하고자 하는 새로운 페이지(들)를 위한 공간을 확보하기 위해 하나 또는 그 이상 페이지들을 먼저 페이지 아웃(Page-Out)하려고 하거나 교체(Replace) 페이지를 선택하는 페이지 교체 정책(Page Replacement Policy)를 선택할 수 있음
3. 페이지 교체 정책은 성능에 큰 악영향을 미칠 수 있으므로 면밀히 검토되어야 함

-----
### 페이지 폴트의 처리
-----
1. 페이지 폴트 처리의 상세한 과정
   - 페이지 폴트 발생 시 하드웨어를 통한 주소 변환
<div align="center">
<img src="https://github.com/user-attachments/assets/f4f1ec54-e3bb-4ba3-9dfb-babeea1fceb6">
</div>

   - 하드웨어 처리 과정에서 TLB 발생 시 세가지 중요한 경우 발생
     + 18 - 21라인 : 페이지가 존재하며 유효한 경우 (TLB 미스 핸들러가 PTE에서 PFN을 가져와서 (여러 차례) 명령어를 재시도(이 때, TLB 히트)
     + 22 - 23라인 : 페이지가 유효하지만, 존재하지 않는 경우 (페이지 폴트 핸들러가 반드시 실행되어야 함 : 프로세스사용할 수 있는 제대로 된 페이지이긴 하지만(유효한 경우이므로), 물리 메모리에 존재하지 않음)
     + 13 - 14라인 : 페이지가 유효하지 않은 경우 (프로그램 버그 등으로 잘못된 주소 접근 등의 경우의 처리이며, PTE의 다른 비트는 의미가 없고, 하드웨어는 이 무효한 접근이 운영체제의 트랩 핸들러에 의해 처리되도록 하며, 이 때 문제를 일으킨 프로세스는 종료될 수 있음)

   - 페이지 폴트 발생 시 운영체제의 동작(소프트웨어)
<div align="center">
<img src="https://github.com/user-attachments/assets/068cfee8-a1b6-4005-982c-8c90f0d9324d">
</div>

   - 운영체제는 탑재할 페이지를 위한 물리 프레임을 확보
     + 만약 여유 프레임이 없다면, 교체 알고리즘을 실행하여 메모리에서 페이지를 내보내고 여유 공간을 확보
     + 물리 프레임을 확보한 후, I/O 요청을 통해 스왑 영역에서 페이지를 읽어옴
     + 마지막으로 느린 작업이 완료되면, 운영체제는 페이지 테이블을 갱신하고 명령어를 재시도
     + 재시도를 하게 되면 TLB 미스가 발생하며, 또 한 번의 재시도를 할 때에 TLB 히트가 됨
